<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Φοιτητική Ολιστική Συμπεριφορική Παρέμβαση</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 22px; max-width: 980px; }
    h1 { margin: 0 0 8px 0; }
    h2 { margin: 18px 0 10px 0; }
    p { line-height: 1.35; }
    .lead { margin: 0 0 16px 0; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin: 12px 0; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .field { flex: 1; min-width: 220px; }
    label { display: block; font-size: 14px; margin: 6px 0; }
    input[type="text"], input[type="email"], textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
    }
    textarea { min-height: 90px; }
    .item { padding: 10px 0; border-top: 1px solid #eee; }
    .item:first-child { border-top: 0; }
    .scale { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px; }
    .scale label { display: inline-flex; align-items: center; gap: 6px; margin: 0; }
    .muted { color: #555; font-size: 13px; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; }
    button { padding: 12px 16px; border: 0; border-radius: 10px; cursor: pointer; }
    #submitBtn { background: #111; color: #fff; }
    #previewBtn { background: #f1f1f1; }
    #status { margin-top: 10px; font-size: 14px; }
    .results { background: #fafafa; border-radius: 10px; padding: 12px; border: 1px solid #eee; }
    .warn { color: #8a2a2a; }
    .ok { color: #1f6f3a; }
    .small { font-size: 12px; }
    .hr { height: 1px; background: #eee; margin: 10px 0; }
  </style>
</head>

<body>
  <h1>Φοιτητική Ολιστική Συμπεριφορική Παρέμβαση</h1>

  <p class="lead">
    Αυτό είναι screening και πρακτικό προφίλ.  
    Σου δίνει τρεις δείκτες που επηρεάζουν μελέτη, συνέπεια, και ανάκαμψη.  
    Σου δίνει προτεραιότητες και ένα πρώτο πλάνο βελτίωσης.
  </p>

  <div class="card">
    <h2>Στοιχεία</h2>

    <div class="row">
      <div class="field">
        <label>Ονοματεπώνυμο</label>
        <input id="name" type="text" placeholder="π.χ. Μαρία Παπαδοπούλου" />
      </div>
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" placeholder="π.χ. maria@email.com" />
      </div>
      <div class="field">
        <label>Σχολή ή Τμήμα</label>
        <input id="school" type="text" placeholder="π.χ. Ψυχολογία" />
      </div>
      <div class="field">
        <label>Έτος φοίτησης</label>
        <input id="year" type="text" placeholder="π.χ. 2ο" />
      </div>
    </div>

    <label>Στόχος για τις επόμενες 4 εβδομάδες</label>
    <textarea id="goal" placeholder="π.χ. να διαβάζω 4 ημέρες την εβδομάδα με σταθερό πρόγραμμα"></textarea>

    <label>Σημειώσεις</label>
    <textarea id="notes" placeholder="π.χ. τι σε δυσκολεύει πιο πολύ"></textarea>

    <label style="margin-top:10px;">
      <input id="consent" type="checkbox" />
      Συμφωνώ να παραχθεί αναφορά και να σταλεί email προς τον Δρ Χιώνη
    </label>

    <p class="muted">
      Αυτό δεν είναι ιατρική διάγνωση.  
      Αν υπάρχει άμεσος κίνδυνος ή έντονη κρίση, ζήτησε άμεση βοήθεια από επείγουσες υπηρεσίες.
    </p>
  </div>

  <div class="card">
    <h2>Κλίμακα 1. Ρύθμιση Συναισθήματος για Μελέτη</h2>
    <p class="muted">Κλίμακα 1 έως 5. 1 σημαίνει καθόλου. 5 σημαίνει πάρα πολύ.</p>
    <div id="erItems"></div>
  </div>

  <div class="card">
    <h2>Κλίμακα 2. Κοινωνική Στήριξη και Ανήκειν</h2>
    <p class="muted">Κλίμακα 1 έως 5. 1 σημαίνει καθόλου. 5 σημαίνει πάρα πολύ.</p>
    <div id="ssItems"></div>
  </div>

  <div class="card">
    <h2>Κλίμακα 3. Ανθεκτικότητα και Επανεκκίνηση</h2>
    <p class="muted">Κλίμακα 1 έως 5. 1 σημαίνει καθόλου. 5 σημαίνει πάρα πολύ.</p>
    <div id="rrItems"></div>
  </div>

  <div class="card">
    <h2>Αποτελέσματα</h2>
    <div class="results" id="resultsBox">Πάτα Προεπισκόπηση για να δεις σκορ.</div>

    <div class="actions">
      <button id="previewBtn" type="button">Προεπισκόπηση σκορ</button>
      <button id="submitBtn" type="button">Ολοκλήρωση και αναφορά</button>
    </div>

    <div id="status"></div>

    <p class="muted small" style="display:none;">
      Με το κουμπί Ολοκλήρωση κατεβαίνει αρχείο .doc.  
      Μετά ανοίγει email προς dchionis10@gmail.com, και εσύ επισυνάπτεις το αρχείο.  
      Αυτό γίνεται επειδή ο browser δεν μπορεί να στείλει συνημμένα μόνος του.
    </p>
  </div>

<script>
  const DOCTOR_EMAIL = "dchionis10@gmail.com";

  const scales = {
    er: {
      title: "Ρύθμιση Συναισθήματος για Μελέτη",
      min: 1, max: 5,
      items: [
        "Όταν πιέζομαι, μπορώ να ηρεμήσω αρκετά ώστε να ξεκινήσω μελέτη.",
        "Μπορώ να αλλάξω την οπτική μου όταν ένα διάβασμα μου φαίνεται βουνό.",
        "Όταν αγχώνομαι, κάνω κάτι μικρό που με επαναφέρει σε 10 λεπτά.",
        "Μπορώ να συνεχίσω μελέτη ακόμη και αν δεν έχω διάθεση.",
        "Όταν κάνω λάθος ή κολλήσω, δεν καταρρέω ψυχολογικά.",
        "Μπορώ να μιλήσω στον εαυτό μου με ήρεμο τρόπο όταν αποτυγχάνω.",
        "Μπορώ να βάλω όριο σε σκέψεις που με τραβάνε σε υπερανάλυση.",
        "Μπορώ να ζητήσω βοήθεια αντί να κλειστώ όταν πιέζομαι."
      ]
    },
    ss: {
      title: "Κοινωνική Στήριξη και Ανήκειν",
      min: 1, max: 5,
      items: [
        "Υπάρχει τουλάχιστον ένα άτομο που μπορώ να μιλήσω χωρίς φόβο κριτικής.",
        "Νιώθω ότι ανήκω σε μία μικρή ομάδα ανθρώπων που με στηρίζει.",
        "Όταν δυσκολεύομαι, μπορώ να ζητήσω πρακτική βοήθεια και να την πάρω.",
        "Όταν δυσκολεύομαι, μπορώ να ζητήσω συναισθηματική στήριξη και να την πάρω.",
        "Έχω ένα άτομο που με ενθαρρύνει με συγκεκριμένο τρόπο για τη σχολή.",
        "Δεν νιώθω μόνη όταν έχω πίεση από εξετάσεις.",
        "Μπορώ να βάλω όρια σε σχέσεις που με εξαντλούν.",
        "Μπορώ να μιλήσω για άγχος ή ντροπή χωρίς να νιώσω ότι εκτίθεμαι."
      ]
    },
    rr: {
      title: "Ανθεκτικότητα και Επανεκκίνηση",
      min: 1, max: 5,
      items: [
        "Μετά από μία κακή μέρα, μπορώ να ξαναμπώ στο πρόγραμμα την επόμενη.",
        "Όταν χάνω ρυθμό, μπορώ να κάνω επανεκκίνηση με μικρό βήμα.",
        "Μπορώ να κρατήσω μία ρουτίνα ύπνου που στηρίζει τη μελέτη.",
        "Μπορώ να κάνω μικρές σταθερές προσπάθειες χωρίς υπερπροσπάθεια.",
        "Αν αποτύχω σε στόχο, μπορώ να το δω σαν δεδομένο και όχι σαν ταυτότητα.",
        "Μπορώ να προστατεύσω ενέργεια και συγκέντρωση από περισπασμούς.",
        "Όταν κουράζομαι, αναγνωρίζω το όριο και κάνω σωστή ανάκαμψη.",
        "Συνήθως βρίσκω τρόπο να συνεχίσω ακόμη και όταν υπάρχουν εμπόδια."
      ]
    }
  };

  function escapeHtml(s) {
    return String(s || "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function renderScale(containerId, key) {
    const sc = scales[key];
    const root = document.getElementById(containerId);
    root.innerHTML = "";

    sc.items.forEach((txt, idx) => {
      const itemNo = idx + 1;
      const wrap = document.createElement("div");
      wrap.className = "item";

      const title = document.createElement("div");
      title.innerHTML = "<strong>" + itemNo + ".</strong> " + escapeHtml(txt);

      const scale = document.createElement("div");
      scale.className = "scale";

      for (let v = sc.min; v <= sc.max; v++) {
        const lab = document.createElement("label");
        lab.innerHTML = '<input type="radio" name="' + key + "_" + itemNo + '" value="' + v + '" /> <span>' + v + "</span>";
        scale.appendChild(lab);
      }

      wrap.appendChild(title);
      wrap.appendChild(scale);
      root.appendChild(wrap);
    });
  }

  function readAnswers(key) {
    const sc = scales[key];
    const answers = [];
    for (let i = 1; i <= sc.items.length; i++) {
      const sel = document.querySelector('input[name="' + key + "_" + i + '"]:checked');
      if (!sel) return null;
      answers.push(Number(sel.value));
    }
    return answers;
  }

  function mean(arr) {
    return arr.reduce((a,b) => a + b, 0) / arr.length;
  }

  function band(score) {
    if (score < 2.6) return { label: "Χαμηλό", cls: "warn" };
    if (score < 3.6) return { label: "Μέτριο", cls: "" };
    return { label: "Υψηλό", cls: "ok" };
  }

  function practicalMeaning(scaleKey, score) {
    const b = band(score).label;

    if (scaleKey === "er") {
      if (b === "Χαμηλό") return [
        "Υπάρχει αυξημένη πιθανότητα μπλοκαρίσματος στην έναρξη μελέτης όταν υπάρχει άγχος.",
        "Υπάρχει αυξημένη πιθανότητα αποφυγής ή υπερανάλυσης όταν ένα task φαίνεται δύσκολο."
      ];
      if (b === "Μέτριο") return [
        "Υπάρχει λειτουργία αλλά σε ημέρες πίεσης πέφτει η συνέπεια.",
        "Βοηθά ένα μικρό πρωτόκολλο επανεκκίνησης πριν από κάθε μπλοκ μελέτης."
      ];
      return [
        "Υπάρχει καλή ρύθμιση και η απόδοση εξαρτάται πιο πολύ από σύστημα και ρουτίνα.",
        "Βοηθά βελτιστοποίηση κανόνων περιβάλλοντος και σαφών μικρών στόχων."
      ];
    }

    if (scaleKey === "ss") {
      if (b === "Χαμηλό") return [
        "Υπάρχει κίνδυνος να σηκώνει όλο το φορτίο μόνη της και να φθείρεται σιωπηλά.",
        "Βοηθά να στηθούν δύο σταθερές επαφές και σαφή όρια σε εξαντλητικές σχέσεις."
      ];
      if (b === "Μέτριο") return [
        "Υπάρχει στήριξη αλλά δεν ενεργοποιείται έγκαιρα όταν ανεβαίνει η πίεση.",
        "Βοηθά πλάνο επικοινωνίας με μικρά αιτήματα και σαφή χρονισμό."
      ];
      return [
        "Υπάρχει λειτουργική στήριξη και μειώνεται το ρίσκο απομόνωσης σε εξεταστικές περιόδους.",
        "Βοηθά να γίνει η στήριξη πιο πρακτική με ρόλους και συμφωνίες."
      ];
    }

    if (scaleKey === "rr") {
      if (b === "Χαμηλό") return [
        "Υπάρχει αυξημένη πιθανότητα να χαλάει ο ρυθμός μετά από setback και να αργεί η επανεκκίνηση.",
        "Βοηθά σταθεροποίηση ύπνου και μικρά βήματα επανόδου με χαμηλή τριβή."
      ];
      if (b === "Μέτριο") return [
        "Υπάρχει επανεκκίνηση αλλά δεν είναι σταθερή όταν συσσωρεύεται κόπωση.",
        "Βοηθά διαχείριση ενέργειας και κανόνες για περισπασμούς."
      ];
      return [
        "Υπάρχει καλή επανεκκίνηση και η πρόοδος εξαρτάται από monitoring και στόχους.",
        "Βοηθά εβδομαδιαίο review με δείκτες και SMART στόχους."
      ];
    }

    return ["", ""];
  }

  function followUpPlan(erScore, ssScore, rrScore) {
    const labels = [band(erScore).label, band(ssScore).label, band(rrScore).label];
    const lows = labels.filter(x => x === "Χαμηλό").length;
    const mids = labels.filter(x => x === "Μέτριο").length;

    if (lows >= 2) {
      return {
        sessions: 8,
        frequency: "1 φορά την εβδομάδα",
        goals: [
          "SMART 1. 4 ημέρες μελέτη την εβδομάδα, 4 μπλοκ των 25 λεπτών ανά ημέρα, για 4 εβδομάδες.",
          "SMART 2. Σταθερό ωράριο ύπνου, απόκλιση έως 45 λεπτά, για 14 ημέρες.",
          "SMART 3. 2 στοχευμένες επαφές στήριξης την εβδομάδα με σαφές αίτημα."
        ]
      };
    }

    if (lows === 1 || mids >= 2) {
      return {
        sessions: 6,
        frequency: "1 φορά την εβδομάδα",
        goals: [
          "SMART 1. 3 ημέρες μελέτη την εβδομάδα, 4 μπλοκ των 25 λεπτών, για 3 εβδομάδες.",
          "SMART 2. Τελετουργικό έναρξης 2 λεπτών πριν από κάθε μπλοκ, για 14 ημέρες.",
          "SMART 3. Πλάνο ανάκαμψης 20 λεπτών, σε 4 βράδια την εβδομάδα, για 3 εβδομάδες."
        ]
      };
    }

    return {
      sessions: 4,
      frequency: "1 φορά ανά 2 εβδομάδες",
      goals: [
        "SMART 1. Εβδομαδιαίο review 15 λεπτών με 3 δείκτες, για 8 εβδομάδες.",
        "SMART 2. Κανόνας κινητού σε ώρες μελέτης, με ένα διάλειμμα ανά 25λεπτο, για 14 ημέρες.",
        "SMART 3. Στόχος σταθερότητας και όχι έντασης, με μικρές βελτιώσεις, για 4 εβδομάδες."
      ]
    };
  }

  function buildPreviewHtml(erM, ssM, rrM, overall) {
    const erB = band(erM);
    const ssB = band(ssM);
    const rrB = band(rrM);
    const ovB = band(overall);

    let html = "";
    html += "<div><strong>Σύνολο</strong></div>";
    html += "<div>Γενικό σκορ " + overall.toFixed(2) + ". <span class='" + ovB.cls + "'>" + ovB.label + "</span></div>";
    html += "<div class='hr'></div>";
    html += "<div><strong>Ανά κλίμακα</strong></div>";
    html += "<div>Ρύθμιση συναισθήματος " + erM.toFixed(2) + ". <span class='" + erB.cls + "'>" + erB.label + "</span></div>";
    html += "<div>Κοινωνική στήριξη " + ssM.toFixed(2) + ". <span class='" + ssB.cls + "'>" + ssB.label + "</span></div>";
    html += "<div>Ανθεκτικότητα " + rrM.toFixed(2) + ". <span class='" + rrB.cls + "'>" + rrB.label + "</span></div>";
    html += "<div class='hr'></div>";
    html += "<div class='muted'>Το αποτέλεσμα είναι screening και όχι διάγνωση.</div>";
    return html;
  }

  function validateAll() {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const consent = document.getElementById("consent").checked;

    if (!name || !email) return { ok: false, msg: "Συμπλήρωσε ονοματεπώνυμο και email." };
    if (!consent) return { ok: false, msg: "Χρειάζεται συγκατάθεση για παραγωγή και αποστολή αναφοράς." };

    const er = readAnswers("er");
    const ss = readAnswers("ss");
    const rr = readAnswers("rr");

    if (!er || !ss || !rr) return { ok: false, msg: "Συμπλήρωσε όλες τις απαντήσεις πριν την ολοκλήρωση." };

    return { ok: true, name, email, er, ss, rr };
  }

  function buildReportText(meta, scores) {
    const now = new Date();
    const stamp = now.toLocaleString("el-GR");

    const erB = band(scores.erScore).label;
    const ssB = band(scores.ssScore).label;
    const rrB = band(scores.rrScore).label;
    const ovB = band(scores.overall).label;

    const erMeaning = practicalMeaning("er", scores.erScore);
    const ssMeaning = practicalMeaning("ss", scores.ssScore);
    const rrMeaning = practicalMeaning("rr", scores.rrScore);

    const plan = followUpPlan(scores.erScore, scores.ssScore, scores.rrScore);

    const lines = [];

    lines.push("Αναφορά Screening Φοιτητικής Ολιστικής Συμπεριφορικής Παρέμβασης");
    lines.push("Ημερομηνία και ώρα " + stamp);
    lines.push("");
    lines.push("Σκοπός αξιολόγησης");
    lines.push("Η αξιολόγηση στοχεύει σε πρακτικό screening για μελέτη, ανθεκτικότητα και στήριξη.");
    lines.push("Το αποτέλεσμα δεν αποτελεί ιατρική διάγνωση και δεν αντικαθιστά κλινική εκτίμηση.");
    lines.push("");
    lines.push("Στοιχεία");
    lines.push("Ονοματεπώνυμο " + (meta.name || ""));
    lines.push("Email " + (meta.email || ""));
    lines.push("Σχολή ή Τμήμα " + (meta.school || ""));
    lines.push("Έτος φοίτησης " + (meta.year || ""));
    lines.push("Στόχος 4 εβδομάδων " + (meta.goal || ""));
    lines.push("Σημειώσεις " + (meta.notes || ""));
    lines.push("");
    lines.push("Τι μετράμε και με τι αντιστοιχεί");
    lines.push("Αυτή η αξιολόγηση είναι screening και όχι ιατρική διάγνωση.");
    lines.push("Στόχος είναι να παραχθεί πρακτικό προφίλ για μελέτη και καθημερινότητα.");
    lines.push("Στόχος είναι να οδηγήσει σε SMART πλάνο και σε follow up, αν χρειάζεται.");
    lines.push("");
    lines.push("Άξονας 1 Ρύθμιση και αντιμετώπιση πίεσης");
    lines.push("Μετράμε πώς ξεκινά η μελέτη όταν υπάρχει στρες.");
    lines.push("Μετράμε πώς αλλάζει η οπτική όταν κάτι φαίνεται βουνό.");
    lines.push("Η θεματική αντιστοιχεί εννοιολογικά σε coping και επαναξιολόγηση.");
    lines.push("");
    lines.push("Άξονας 2 Κοινωνική στήριξη και ανήκειν");
    lines.push("Μετράμε πόσο εύκολα ενεργοποιείται στήριξη όταν υπάρχει πίεση.");
    lines.push("Μετράμε πόσο ασφαλές είναι να μιλήσει χωρίς φόβο κριτικής.");
    lines.push("Η θεματική αντιστοιχεί εννοιολογικά σε απομόνωση, μοναξιά, και μοτίβα δεσμού.");
    lines.push("");
    lines.push("Άξονας 3 Ανάκαμψη και λειτουργική σταθερότητα");
    lines.push("Μετράμε πόσο γρήγορα γίνεται επανεκκίνηση μετά από setback.");
    lines.push("Μετράμε πόσο σταθερές είναι ρουτίνες που στηρίζουν ύπνο και συγκέντρωση.");
    lines.push("Η θεματική αντιστοιχεί εννοιολογικά σε ανάκαμψη, ύπνο, και λειτουργικότητα.");
    lines.push("");
    lines.push("Πώς δένει με SARIM");
    lines.push("Ο άξονας 1 αφορά εκτίμηση πίεσης και άμεση αντίδραση.");
    lines.push("Ο άξονας 2 αφορά πόρους και κανάλια στήριξης.");
    lines.push("Ο άξονας 3 αφορά ανάκαμψη και feedback loop μέσα στην εβδομάδα.");
    lines.push("");
    lines.push("Σημείωση για την αντιστοίχιση");
    lines.push("Οι αντιστοιχίες είναι εννοιολογικές και δεν είναι ισοδυναμία τεστ.");
    lines.push("Τα items είναι πρωτότυπα και είναι φτιαγμένα για εφαρμογή σε φοιτητικό πλαίσιο.");
    lines.push("");
    lines.push("Αποτελέσματα");
    lines.push("Γενικό σκορ " + scores.overall.toFixed(2) + " Επίπεδο " + ovB);
    lines.push("Ρύθμιση συναισθήματος " + scores.erScore.toFixed(2) + " Επίπεδο " + erB);
    lines.push("Κοινωνική στήριξη " + scores.ssScore.toFixed(2) + " Επίπεδο " + ssB);
    lines.push("Ανθεκτικότητα " + scores.rrScore.toFixed(2) + " Επίπεδο " + rrB);
    lines.push("");
    lines.push("Τι σημαίνουν πρακτικά");
    lines.push("Ρύθμιση συναισθήματος");
    lines.push("1 " + erMeaning[0]);
    lines.push("2 " + erMeaning[1]);
    lines.push("");
    lines.push("Κοινωνική στήριξη");
    lines.push("1 " + ssMeaning[0]);
    lines.push("2 " + ssMeaning[1]);
    lines.push("");
    lines.push("Ανθεκτικότητα");
    lines.push("1 " + rrMeaning[0]);
    lines.push("2 " + rrMeaning[1]);
    lines.push("");
    lines.push("Πρόταση follow up");
    lines.push("Προτεινόμενες συνεδρίες " + plan.sessions);
    lines.push("Συχνότητα " + plan.frequency);
    lines.push("Στοχοθεσία SMART");
    plan.goals.forEach(g => lines.push(g));
    lines.push("");
    lines.push("Σημείωση ασφάλειας");
    lines.push("Αν υπάρχουν ενδείξεις σοβαρής επιβάρυνσης ή κινδύνου, προτείνεται άμεση κλινική εκτίμηση.");

    return lines.join("\n");
  }

  function downloadDoc(filename, text) {
    const html = `
      <html><head><meta charset="utf-8"></head><body>
      <pre style="font-family: Arial, sans-serif; white-space: pre-wrap;">${escapeHtml(text)}</pre>
      </body></html>
    `;
    const blob = new Blob([html], { type: "application/msword;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();

    setTimeout(() => URL.revokeObjectURL(url), 4000);
  }

  function openMailTo(meta, scores) {
    const subject = encodeURIComponent("Νέα αναφορά Φοιτητικής Ολιστικής Συμπεριφορικής Παρέμβασης");
    const bodyLines = [];
    bodyLines.push("Καλησπέρα.");
    bodyLines.push("Επισυνάπτω την αναφορά screening σε αρχείο .doc.");
    bodyLines.push("Ονοματεπώνυμο " + (meta.name || ""));
    bodyLines.push("Email " + (meta.email || ""));
    bodyLines.push("Γενικό σκορ " + scores.overall.toFixed(2));
    bodyLines.push("Παρακαλώ δείτε το συνημμένο.");
    const body = encodeURIComponent(bodyLines.join("\n"));
    const link = "mailto:" + encodeURIComponent(DOCTOR_EMAIL) + "?subject=" + subject + "&body=" + body;
    window.location.href = link;
  }

  function computeScores(er, ss, rr) {
    const erScore = mean(er);
    const ssScore = mean(ss);
    const rrScore = mean(rr);
    const overall = mean([erScore, ssScore, rrScore]);
    return { erScore, ssScore, rrScore, overall };
  }

  document.getElementById("previewBtn").addEventListener("click", () => {
    const v = validateAll();
    if (!v.ok) {
      document.getElementById("resultsBox").innerHTML = escapeHtml(v.msg);
      return;
    }
    const scores = computeScores(v.er, v.ss, v.rr);
    document.getElementById("resultsBox").innerHTML = buildPreviewHtml(scores.erScore, scores.ssScore, scores.rrScore, scores.overall);
  });

  document.getElementById("submitBtn").addEventListener("click", async () => {
    const statusEl = document.getElementById("status");
    statusEl.textContent = "";

    const v = validateAll();
    if (!v.ok) {
      statusEl.textContent = v.msg;
      return;
    }

    const meta = {
      name: document.getElementById("name").value.trim(),
      email: document.getElementById("email").value.trim(),
      school: document.getElementById("school").value.trim(),
      year: document.getElementById("year").value.trim(),
      goal: document.getElementById("goal").value.trim(),
      notes: document.getElementById("notes").value.trim()
    };

    const scores = computeScores(v.er, v.ss, v.rr);
    const reportText = buildReportText(meta, scores);

    const safeName = (meta.name || "report").replace(/[^\p{L}\p{N}\s]/gu, "").trim().slice(0, 60) || "report";
    const filename = "Αναφορά_" + safeName + ".doc";

    downloadDoc(filename, reportText);

    try {
      await navigator.clipboard.writeText(reportText);
    } catch (e) {
    }

    alert("Ευχαριστούμε για την υποβολή. Επικοινωνείστε με τον Δρ Χιώνη παρακαλούμε.");

    openMailTo(meta, scores);

    statusEl.textContent = "Κατέβηκε η αναφορά και άνοιξε email. Επισύναψε το αρχείο και στείλε.";
  });

  renderScale("erItems", "er");
  renderScale("ssItems", "ss");
  renderScale("rrItems", "ss"); // guard against accidental wrong id call
  renderScale("rrItems", "rr");
</script>
</body>
</html>

